# 软件安装

## 搜索软件包

在 https://search.nixos.org/packages 中可以搜索 Nix 中已有的软件包，注意选择与自己使用版本匹配的 Channel。

也可以使用 `nix search` 进行搜索。

## 用户级安装

以安装 vim 为例：

```bash
nix-env -iA nixos.vim
```

如果是在非 NixOS 中使用 Nix，应该使用 nixpkgs.vim 而非 nixos.vim。

这种安装方法不需要 root 权限， 且安装的应用仅对当前用户可见，你可以在 ~/.nix-profile/bin 目录找的 nvim。

## 系统级安装

向 configuration.nix 的 systemPackages 列表中添加软件包：

```nix
  environment.systemPackages = with pkgs; [
    vim
  ];
```

之后执行 `nixos-rebuild switch` 即可安装。

你可以在 /run/current-system/sw/bin 目录找到 nvim。

但是，上述找到的 nvim 都是软连接，无论哪种方法安装的软件实际都在 /nix/store 中，一个名字类似于 xqjwhyapv15bbrjxxnqia7dpf2smxgfd-neovim-0.6.0 的目录里。

## 使用非自由软件

nix 默认不支持安装非自由软件，但是很多非自由软件是非常有用的，比如google-chrome，vscode。可以通过配置来支持：

如果只是临时允许，可以通过设置环境变量：

```bash
 export NIXPKGS_ALLOW_UNFREE=1
```

对于 `nixos-rebuild`， 在 configuration.nix 中添加以下配置

```nix
{ nixpkgs.config.allowUnfree = true; }
```

对于 `nix-env`, `nix-build`, `nix-shell` 等命令，在 ~/.config/nixpkgs/config.nix 中添加以下配置：

```nix
{ allowUnfree = true; }
```
如果没有这个文件，直接创建一下就可以了。
